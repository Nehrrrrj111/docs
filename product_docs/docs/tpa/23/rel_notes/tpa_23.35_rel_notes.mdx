---
title: Trusted Postgres Architect 23.35 release notes
navTitle: Version 23.35
---


Released: 29 October 2024


New features, enhancements, bug fixes, and other changes in Trusted Postgres Architect 23.35 include the following:


## Highlights
- More Trust
- More Postgres
- More Architect


## Changes

<table class="table w-100"><thead><tr><th>Description</th><th width="10%">Addresses</th></tr></thead><tbody>
<tr><td><details><summary>Remove deprecated <code>PermissionStartOnly</code> in postgres.service.j2 template</summary><hr/><p><code>PermissionsStartOnly</code> has been deprecated and is now achieved via  <code>ExecStartPost=+/bin/bash...</code> syntax.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Add <code>postgis</code> to list of recognized extensions</summary><hr/><p>The PostGIS package will automatically be added when a user specifies  <code>postgis</code>
as an entry in either <code>postgres_extensions</code> or the list of extensions named under
<code>postgres_databases</code>.  Also enables the CRB (Code Ready Builder) repository for
RHEL-compatible distributions so PostGIS dependencies can be installed.</p>
</details></td><td></td></tr>
<tr><td><details><summary>The <code>barman</code> Postgres user should not be a superuser</summary><hr/><p>Certain required privileges are granted to Postgres role, <code>barman_role</code>,
which is then granted to the <code>barman</code> Postgres user. This avoids creating the
<code>barman</code> user as a superuser. This role can also be granted to other Postgres
users by adding it to their <code>granted_roles</code> list using <code>postgres/createuser</code>.  The
<code>barman_role</code> is created as part of the Barman tasks; if Barman is not used, this
role will not be created. Therefore, the task that grants privileges to this role
is only executed if the <code>barman_role</code> username is in the list  of Postgres users
that are created.  The ''barman'' user now has <code>NOSUPERUSER</code> explicitly specified
as a role attribute.  If a cluster was deployed with a previous TPA version (which
created the ''barman''  user as a superuser), deploying with this version will
remove the <code>superuser</code> role attribute from the <code>barman</code> user.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Improve postgres-monitor script</summary><hr/><p>Improve postgres-monitor script to better manage recoverable errors and
add retries on network errors to ensure that it won''t return failure when it
just didn't allow enough time for postgres service to  be fully started.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Only add nodes with <code>efm</code> role to cluster <code>efm.nodes</code> file</summary><hr/><p>A support ticket questioned why the <code>pemserver</code> and <code>barman</code> nodes are
added to the <code>Allowed node host list</code> in EFM when they are not  relevant to EFM
functions. Refactored the task that writes the <code>efm.node</code> configuration to only
include those nodes that have <code>efm</code> in their list  of roles.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Enable EFM probes when a PEM agent is registered on an EFM node</summary><hr/><p>The <code>--efm-install-path</code> and <code>--efm-cluster-name</code> flags are set when a  PEM
server is registered on an EFM node.   The <code>Streaming Replication</code>, <code>Failover Manager Node Status</code> and  <code>Failover Manager Cluster Info</code> probes are enabled when
a PEM agent is  registered on an EFM node. '</p>
</details></td><td></td></tr>
</tbody></table>


## Bug Fixes

<table class="table w-100"><thead><tr><th>Description</th><th width="10%">Addresses</th></tr></thead><tbody>
<tr><td><details><summary>Fix tpaexec test for pgd-proxy config verification</summary><hr/><p>Fixed a bug whereby the test that ensures the current pgd-proxy configuration
matches the expected configuration would fail for version &lt; 5.5.0. This fix ensures
that TPA won't try to query configuration keys added in version 5.5.0.</p>
</details></td><td></td></tr>
<tr><td><details><summary><code>primary_slot_name</code> added for EFM compatibility interferes with <code>bdr_init_physical</code></summary><hr/><p>A <code>primary_slot_name</code> is configured on the primary node to  ensure the
old primary uses a physical slot for replication  during an EFM switchover. However,
''bdr_init_physical'' attempts  to use it for node initialisation and hangs indefinitely
since  the slot does not exist in a PGD installation.  This <code>primary_slot_name</code>
is now conditionally set explicitly when the  <code>failover_manager</code> is EFM to avoid
setting it unnecessarily.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Download correct <code>bash-completion</code> package version</summary><hr/><p>If the <code>pgdcli_package_version</code> is specified in <code>config.yml</code>, the  <code>bash-completion</code>
package is incorrectly named because the  <code>packages_for</code> filter erroneously appends
the <code>pgdcli_package_version</code>  to the  package name. This results in an attempt
to download a nonexistant package.  The <code>bash-completion</code> package is now appended
to the list after the <code>packages_for</code> filter, since it''s version is independent
from the  <code>pgdcli_package_version</code>.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Clear error message stack after each task</summary><hr/><p>Fixed an issue whereby in some cases error messages would be repeated
even after successful tasks.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Enable new replicas in patroni clusters</summary><hr/><p>Fixed an issue whereby new replicas in patroni clusters would fail with
errors related to replication slots.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Add <code>pem-agent</code> role on barman nodes at most once for M1 architecture</summary><hr/><p>'If <code>--enable-pem</code> and <code>--enable-pg-backup-api</code> are passed to <code>tpaexec configure</code>, <code>pem-agent</code> is added twice to the <code>barman</code> node if it is also a <code>witness</code>.  Fixed
by by consolidating both <code>if</code> statements together to only evaluate  the conditions
once. '</p>
</details></td><td></td></tr>
<tr><td><details><summary>set pem_python_executable outside pkg role</summary><hr/><p>Fixed a bug whereby if the user excluded the <code>pkg</code> selector, later pem-related
tasks would fail because the pem_python_executable fact had not been set.</p>
</details></td><td></td></tr>
</tbody></table>


